{% extends "admin/change_list.html" %}
{% load static %}

{# 1) Кнопки в тулзах #}
{% block object-tools-items %}
    {{ block.super }}
    <li>
        <a href="{{ sync_keys_url }}">Синхронизировать SSH ключи</a>
    </li>
    <li>
        <button id="toggle-instructions-btn" type="button" class="button">
            Показать инструкцию
        </button>
    </li>
{% endblock %}

{# 2) Скрытый блок с инструкцией #}
{% block content %}
    {{ block.super }}
    <div id="instructions-block"
         class="module aligned"
         style="display: none; margin-top: 20px;">
      <h2>Инструкция по изменению прав доступа к приватному ключу</h2>
      <p>Если при подключении к серверу вы видите ошибку о незащищённом ключе:</p>
      <pre><code>@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@         WARNING: UNPROTECTED PRIVATE KEY FILE!          @
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
Permissions for '/путь/до/файла.pem' are too open.
This private key will be ignored.
Load key "/путь/до/файла.pem": bad permissions
Permission denied (publickey)
</code></pre>
      <p>Измените права на вашем клиенте:</p>
      <ul>
        <li><strong>Linux/macOS:</strong>
          <ul>
            <li>В терминале выполните:
              <code>chmod 600 /путь/до/файла.pem</code>
            </li>
          </ul>
        </li>
        <li><strong>Windows (CMD):</strong>
          <ul>
            <li>Запустите CMD от администратора и выполните:
              <code>icacls "C:\путь\до\файла.pem" /inheritance:r /grant:r %USERNAME%:F</code>
            </li>
          </ul>
        </li>
      </ul>
    </div>
{% endblock %}

{# 3) Подключаем JS в <head> с defer (extrahead) #}
{% block extrahead %}
    {{ block.super }}
    <script defer>
    document.addEventListener('DOMContentLoaded', function() {
        var btn   = document.getElementById('toggle-instructions-btn'),
            block = document.getElementById('instructions-block');
        if (!btn || !block) return;
        btn.addEventListener('click', function() {
            block.style.display = (block.style.display === 'none') ? 'block' : 'none';
        });
    });
    </script>
{% endblock %}
